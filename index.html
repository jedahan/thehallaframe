<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Cecropia's The Hall VR in A-Frame</title>


    <meta property="og:title" content="WCMA-Frame" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://github.com/wcmaart/api/" />

    <meta name="description" content="WCMA-Frame based on Cecropia's The Hall VR">

    <link rel="stylesheet" type="text/css" href="style.css">

    <script src="js/aframe.0.7.0.min.js"></script>
    <script src="js/aframe-extras.min.js"></script>

    <script src="js/lzma.js"></script>
    <script src="js/ctm.js"></script>
    <script src="js/CTMLoader.js"></script>

    <script src="js/aframe-teleport-controls.min.js"></script>
    <script src="js/mocap.js"></script>
    <script src="js/envMapMaterial.js"></script>
    <script src="js/ctm_component.js"></script>
    <script src="js/mobile_component.js"></script>
  </head>

  <body>

    <div id="container" class="container">
      <div class="info">
        <div class="title">The Hall</div>
      </div>
    </div>

<a-scene inspector="url: https://aframe.io/releases/0.3.0/aframe-inspector.min.js">

      <a-entity mobile></a-entity>

      <a-entity light="type: directional; color: #FFF; intensity: 0.5" position="2 20 0"></a-entity>
      <a-entity light="type: ambient; color: #FFF"></a-entity>

      <!-- Custom components with animations -->
      <a-entity spheres material="shader: envMapMaterial; src:textures/cube/hall/; "></a-entity>
      <a-entity anim_1></a-entity>
      <a-entity anim_2></a-entity>

      <!-- - Custom components with animations -->

      <a-assets>
        <a-mixin id="checkpoint"></a-mixin>
        <a-mixin id="checkpoint-hovered" color="#6CEEB5"></a-mixin>


        <img id="sky_sphere-texture" src="textures/sky_sphere.jpg">
        <!-- floor -->
        <a-asset-item id="floor-obj" src="models/floor.obj"></a-asset-item>
        <img id="floor-texture" src="textures/floor.jpg">
        <img id="floor_normal-texture" src="textures/floor_normal.jpg">
        <!-- - floor -->

        <!-- hall -->
        <a-asset-item id="hall-obj" src="models/hall.obj"></a-asset-item>
        <img id="hall-texture" src="textures/hall.jpg">
        <!--<img id="hall_normal-texture" src="textures/hall_normal.jpg">-->
        <!-- - hall -->

        <!-- hall low floor -->
        <!-- this piece is only meant for teleportation -->
        <a-asset-item id="hall_low_floor-obj" src="models/hall_low_floor.obj"></a-asset-item>

        <!-- - hall low floor-->

        <!-- acropolis -->
        <a-asset-item id="acropolis-obj" src="models/acropolis.obj"></a-asset-item>
        <img id="acropolis-texture" src="textures/acropolis.jpg">
        <!-- - acropolis -->
      </a-assets>

      <a-sky color="#EEEEFF" material="src: #sky_sphere-texture"></a-sky>

      <a-entity obj-model="obj: #floor-obj;" material="src: #floor-texture; normalMap: #floor_normal-texture; metalness: 0.6" id="floor"></a-entity>
      <a-entity obj-model="obj: #hall-obj;" material="src: #hall-texture" id="hall"></a-entity>
      <a-entity obj-model="obj: #hall_low_floor-obj;" material="opacity: 0.0" id="hall_low_floor"></a-entity>
      <a-entity id='testid' obj-model="obj: #acropolis-obj;" material="src: #acropolis-texture"></a-entity>
    </a-scene>

    <script src="main.js"></script>

    <script>
      let query = `{
        Artworks(ids: [123]) {
          filename
          title
        }
      }`
      query = `{
        getObject(id: 123) {
          primaryMedia {
            value
          }
        }
      }`

      fetch('http://localhost:4000/graphql', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({query})
      })
        .then(res => res.json())
        .then(response => {
          const assets = document.querySelector('a-assets')
          const relative = response.data.getObject.primaryMedia.value
          const src = `http://localhost:4000/egallery/${relative}`
          
          const img = document.createElement('img')
          img.setAttribute('id', 'loadedimg')
          img.setAttribute('crossorigin', 'anonymous');
          img.setAttribute('src', src)

          img.addEventListener('load', el => {
            console.dir({el})
            let obj = document.getElementById('testid')
            obj.setAttribute('material', {src: '#loadedimg'})
            console.log({obj})
          })

          assets.appendChild(img)
        })
    </script>

  </body>

</html>
